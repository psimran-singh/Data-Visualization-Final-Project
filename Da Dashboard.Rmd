---
title: "Solar Adoption in New Jersey"
output: 
  flexdashboard::flex_dashboard:
    theme: darkly
    orientation: rows
    source_code: "https://github.com/psimran-singh/Data-Visualization-Final-Project"
    vertical_layout: fill
runtime: shiny

---
```{r global, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(shiny)
library(plotly)
library(formattable)
library(DT)
library(lubridate)
library(xts)
library(dygraphs)
library(nivocal)

<<<<<<< HEAD
=======
setwd("~/GitHub/Data-Visualization-Final-Project/Data Files for Analysis")

## Section 1: Overall Landscape ##
# Load in all the data we need
county_level_rates <- read_csv('County_Totals.csv')

## Section 2: Overall Trends ## 
>>>>>>> parent of 24ec4b5 (Updated county level charts)
# Load in all the data we need
setwd("~/GitHub/Data-Visualization-Final-Project/Data Files for Analysis")
trend <- read_csv('Trend.csv')
totals <- read_csv('kw_co2_conversions.csv')


```


<<<<<<< HEAD
Overall Trends
=====================================

<<<<<<< HEAD
<!-- Solar Energy in New Jersey {.sidebar} -->
<!-- ----------------------------------------------------------------------- -->
<!-- Placeholder - Talk about some stuff -->
=======
=======
>>>>>>> parent of 24ec4b5 (Updated county level charts)
{.sidebar}
-----------------------------------------------------------------------

Select your county below.

```{r}
selectInput("County", "County:", choices = distinct(county_level_rates, `County`))
# renderUI({county_name <- county_level_rates %>% filter(`County` == input$County) %>% .$county.name
```
>>>>>>> parent of 24ec4b5 (Updated county level charts)

<<<<<<< HEAD
=======

<!-- ```{r} -->
<!-- renderUI({state_name <- state_data %>% filter(state.abb == input$state) %>% .$state.name -->
<!-- state_equipment <- data1033 %>% filter(State == input$state) -->
<!-- top_agency <- state_equipment %>% group_by(`Station Name (LEA)`) %>% tally() %>% arrange(desc(n)) %>% top_n(1) -->
<!-- tags$h2(paste(state_name, 'at a glance') -->
<!-- )}) -->
<!-- renderUI({state_equipment <- data1033 %>% filter(State == input$state) -->
<!-- top_agency <- state_equipment %>% group_by(`Station Name (LEA)`) %>% tally() %>% arrange(desc(n)) %>% top_n(1) -->
<!-- tags$p(paste('The most militarized agency was', top_agency$`Station Name (LEA)`,'which received',top_agency$n, 'shipments.'))}) -->
<!-- ``` -->
>>>>>>> parent of 24ec4b5 (Updated county level charts)

<!-- ```{r} -->
<!-- renderUI({state_name <- state_data %>% filter(state.abb == input$state) %>% .$state.name -->
<!-- state_equipment <- data1033 %>% filter(State == input$state) -->
<!-- top_agency <- state_equipment %>% group_by(`Station Name (LEA)`) %>% tally() %>% arrange(desc(n)) %>% top_n(1) -->
<!-- tags$h2(paste(state_name, 'at a glance') -->
<!-- )}) -->
<!-- renderUI({state_equipment <- data1033 %>% filter(State == input$state) -->
<!-- top_agency <- state_equipment %>% group_by(`Station Name (LEA)`) %>% tally() %>% arrange(desc(n)) %>% top_n(1) -->
<!-- tags$p(paste('The most militarized agency was', top_agency$`Station Name (LEA)`,'which received',top_agency$n, 'shipments.'))}) -->
<!-- ``` -->

### Total Current Installed Solar Capacity

```{r}
renderValueBox({
  total_cap <- paste(prettyNum(totals[1,2]/1000,big.mark=",",digits=0)," MW")
  valueBox(total_cap, 
           icon = "fa-sun")
})
```

### Total Metric Tons of CO~2~ Emissions Avoided

```{r}
renderValueBox({
  total_co2 <- paste(prettyNum(totals[1,3],big.mark=","))
  valueBox(total_co2,
           icon = "")
})
```


<<<<<<< HEAD
<<<<<<< HEAD
### Total Passenger Cars Taken Off the Road for 1 Year

```{r}
renderValueBox({
  total_cars <- prettyNum(totals[1,4],big.mark=",")
  valueBox(total_cars,
           icon = "")
=======
=======
>>>>>>> parent of 24ec4b5 (Updated county level charts)

Overall Trends
=====================================

<!-- Solar Energy in New Jersey {.sidebar} -->
<!-- ----------------------------------------------------------------------- -->
<!-- Placeholder - Talk about some stuff -->

Row
-----------------------------------------------------------------------

### Year over Year Installed Capacity Growth (2020-2021)

```{r}
renderValueBox({
  cap_yoy <- paste(prettyNum(trend_yoy[22,9],big.mark=",",digits=2))
  valueBox(cap_yoy, 
           icon = "fa-sun")
<<<<<<< HEAD
>>>>>>> parent of 24ec4b5 (Updated county level charts)
=======
>>>>>>> parent of 24ec4b5 (Updated county level charts)
})
```

### Total Tree Seedlings Grown for 10 Years

```{r}
renderValueBox({
  total_trees <- prettyNum(totals[1,5],big.mark=",")
  valueBox(total_trees,
           icon = "")
})
```

Row {.tabset}
-----------------------------------------------------------------------

### Cumulative Capacity Trend

```{r}
fig1 <- plot_ly(trend, x = ~Year, y = ~`Residential Capacity (Cumulative)`,
               type = 'bar', name = 'Residential') %>% 
  add_trace(y = ~`Non-Residential Capacity (Cumulative)`, name = 'Non-Residential') %>%
  add_trace(y = ~`Grid Supply Capacity (Cumulative)`, name = 'Grid Supply') %>%
  layout(yaxis = list(title = "Capacity (MW)"), 
         xaxis = list(title = "Year", tickangle = -45, tickmode = 'linear'),
         barmode='stack')
fig1
```

### Yearly Capacity Growth Trend

```{r}
fig2 <- plot_ly(trend, x = ~Year, y = ~`Residential Capacity`,
               type = 'bar', name = 'Residential') %>% 
  add_trace(y = ~`Non-Residential Capacity`, name = 'Non-Residential') %>%
  add_trace(y = ~`Grid Supply Capacity`, name = 'Grid Supply') %>%
  layout(yaxis = list(title = "Capacity (MW)"), 
         xaxis = list(title = "Year", tickangle = -45, tickmode = 'linear'),
         barmode='stack')
fig2
```

### Cumulative Quantity Trend

```{r}
fig3 <- plot_ly(trend, x = ~Year, y = ~`Residential Quantity (Cumulative)`,
               type = 'bar', name = 'Residential') %>% 
  add_trace(y = ~`Non-Residential Quantity (Cumulative)`, name = 'Non-Residential') %>%
  add_trace(y = ~`Grid Supply Quantity (Cumulative)`, name = 'Grid Supply') %>%
  layout(yaxis = list(title = "Quantity"), 
         xaxis = list(title = "Year", tickangle = -45, tickmode = 'linear'),
         barmode='stack')
fig3
```

### Yearly Quantity Growth Trend

```{r}
fig4 <- plot_ly(trend, x = ~Year, y = ~`Residential Quantity`,
               type = 'bar', name = 'Residential') %>% 
  add_trace(y = ~`Non-Residential Quantity`, name = 'Non-Residential') %>%
  add_trace(y = ~`Grid Supply Quantity`, name = 'Grid Supply') %>%
  layout(yaxis = list(title = "Quantity"), 
         xaxis = list(title = "Year", tickangle = -45, tickmode = 'linear'),
         barmode='stack')
fig4
```




Current Landscape by County
=====================================

<!-- Solar Energy in New Jersey {.sidebar} -->
<!-- ----------------------------------------------------------------------- -->
<!-- Placeholder - Talk about some stuff -->

Row
-----------------------------------------------------------------------
<<<<<<< HEAD

### Total Current Installed Solar Capacity

```{r}
renderValueBox({
  total_cap <- paste(prettyNum(totals[1,2]/1000,big.mark=",",digits=0)," MW")
  valueBox(total_cap, 
           icon = "fa-sun")
})
```

### Total Metric Tons of CO~2~ Emissions Avoided

```{r}
renderValueBox({
  total_co2 <- paste(prettyNum(totals[1,3],big.mark=","))
  valueBox(total_co2,
           icon = "")
=======
```{r}
DT::renderDataTable({
  DT::datatable(trend_trans,
                class = 'cell-border stripe',
                extensions = 'Responsive', 
                escape = FALSE, 
                rownames = FALSE, 
                options = list(bPaginate = FALSE,
                               ordering=FALSE,
                               autoWidth = TRUE,
  columnDefs = list(list(width = '200px', targets = "_all"),
                    list(className = 'dt-center', targets = "_all"))))
>>>>>>> parent of 85fd945 (Update Da Dashboard.Rmd)
})
```


<<<<<<< HEAD
### Total Passenger Cars Taken Off the Road for 1 Year

```{r}
renderValueBox({
  total_cars <- prettyNum(totals[1,4],big.mark=",")
  valueBox(total_cars,
           icon = "")
})
```

### Total Tree Seedlings Grown for 10 Years

```{r}
renderValueBox({
  total_trees <- prettyNum(totals[1,5],big.mark=",")
  valueBox(total_trees,
           icon = "")
})
```


Current Residential Landscape
=====================================



Current Landscape by County
=====================================
=======

>>>>>>> parent of 85fd945 (Update Da Dashboard.Rmd)
